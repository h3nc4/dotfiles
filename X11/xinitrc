#!/bin/sh
# shellcheck disable=SC2154
export DISPLAY=:0

. "${HOME}/.config/env"

start_if_missing() {
	if ! pgrep -x "$1" >/dev/null 2>&1; then
		$1 &
	fi
}

xset +fp "${HOME}/.local/share/fonts/"
xset fp rehash

"${HOME}/.config/X11/dyn-wallpapers" -s "${WALLPAPER_DIR}/landscape.jpg" &
"${HOME}/.config/X11/dyn-status" &
"${HOME}/.config/X11/monitors"

xwallpaper --zoom "${WALLPAPER_DIR}/landscape.jpg"

compton &

start_if_missing pipewire
start_if_missing pipewire-pulse
start_if_missing wireplumber

(
	sleep 3
	xmodmap "${HOME}/.config/X11/xmodmap"
) &

if id -u dev >/dev/null 2>&1; then
	xhost +SI:localuser:dev
fi

exec dwm
